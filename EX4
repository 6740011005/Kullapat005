<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List - Shopping Mall</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* เพิ่มฟอนต์ภาษาไทยให้ดูดีขึ้น */
        body { font-family: 'Sarabun', sans-serif; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const ProductList = () => {
            const [products, setProducts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');

            // ดึงข้อมูลสินค้าจาก API
            useEffect(() => {
                fetch('https://fakestoreapi.com/products')
                    .then((res) => {
                        if (!res.ok) throw new Error('ไม่สามารถดึงข้อมูลได้');
                        return res.json();
                    })
                    .then((data) => {
                        setProducts(data);
                        setLoading(false);
                    })
                    .catch((err) => {
                        setError(err.message);
                        setLoading(false);
                    });
            }, []);

            // กรองสินค้าตามเงื่อนไข (Search & Category)
            const filteredProducts = products.filter((product) => {
                const matchesSearch = product.title.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            // สร้างรายการหมวดหมู่ที่ไม่ซ้ำกัน
            const categories = ['all', ...new Set(products.map((p) => p.category))];

            if (loading) return <div class="text-center p-20 text-xl font-bold">กำลังโหลดข้อมูลสินค้า...</div>;
            if (error) return <div class="text-center p-20 text-red-500 font-bold">เกิดข้อผิดพลาด: {error}</div>;

            return (
                <div class="p-6 max-w-6xl mx-auto">
                    <h1 class="text-4xl font-extrabold mb-8 text-gray-800 border-b pb-4">รายการสินค้า</h1>

                    {/* ส่วนตัวควบคุมการกรอง */}
                    <div class="flex flex-col md:flex-row gap-4 mb-10">
                        <div class="relative flex-1">
                            <input
                                type="text"
                                placeholder="ค้นหาชื่อสินค้า..."
                                class="border p-3 pl-4 rounded-lg w-full shadow-sm focus:ring-2 focus:ring-blue-400 outline-none transition"
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        
                        <select 
                            class="border p-3 rounded-lg w-full md:w-1/4 shadow-sm bg-white cursor-pointer focus:ring-2 focus:ring-blue-400 outline-none"
                            onChange={(e) => setSelectedCategory(e.target.value)}
                        >
                            {categories.map((cat) => (
                                <option key={cat} value={cat}>
                                    {cat === 'all' ? 'ทุกหมวดหมู่' : cat.charAt(0).toUpperCase() + cat.slice(1)}
                                </option>
                            ))}
                        </select>
                    </div>

                    {/* แสดงผลการ์ดสินค้า */}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                        {filteredProducts.length > 0 ? (
                            filteredProducts.map((product) => (
                                <div key={product.id} class="bg-white border rounded-xl p-5 shadow-sm hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 flex flex-col">
                                    <div class="h-48 w-full flex items-center justify-center p-4 bg-gray-50 rounded-lg mb-4">
                                        <img 
                                            src={product.image} 
                                            alt={product.title} 
                                            class="max-h-full max-w-full object-contain"
                                        />
                                    </div>
                                    <div class="flex flex-col flex-grow">
                                        <span class="text-[10px] text-blue-600 font-bold uppercase tracking-wider mb-1 bg-blue-50 px-2 py-1 rounded self-start">
                                            {product.category}
                                        </span>
                                        <h3 class="font-bold text-gray-800 leading-tight line-clamp-2 h-12 mb-2">
                                            {product.title}
                                        </h3>
                                        <div class="mt-auto flex justify-between items-center pt-4 border-t">
                                            <p class="text-2xl text-green-600 font-extrabold">${product.price}</p>
                                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition">
                                                ดูรายละเอียด
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))
                        ) : (
                            <div class="col-span-full py-20 text-center">
                                <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" class="w-24 h-24 mx-auto opacity-20 mb-4" />
                                <p class="text-gray-400 text-lg">ไม่พบสินค้าที่ตรงตามเงื่อนไขที่คุณค้นหา</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // เริ่มต้นการ Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProductList />);
    </script>
</body>
</html>
